<!-- [file name]: donor_dashboard.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Donor Dashboard - OrganBridge{% endblock %}

{% block css_section %}
<style>
    /* üé® Donor Dashboard Styles */
    
    /* Availability Toggle */
    .toggle-checkbox:checked {
        right: 0;
        border-color: #10b981;
    }
    
    .toggle-checkbox:checked + .toggle-label {
        background-color: #10b981;
    }
    
    /* Organ Tags */
    .organ-tag {
        display: inline-block;
        padding: 4px 12px;
        margin: 2px;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 500;
    }
    
    .organ-kidney { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
    .organ-liver { background: #dbeafe; color: #1e40af; border: 1px solid #bfdbfe; }
    .organ-heart { background: #fef3c7; color: #92400e; border: 1px solid #fde68a; }
    .organ-lungs { background: #fce7f3; color: #9d174d; border: 1px solid #fbcfe8; }
    .organ-pancreas { background: #f3e8ff; color: #7c3aed; border: 1px solid #e9d5ff; }
    .organ-intestine { background: #ffedd5; color: #9a3412; border: 1px solid #fed7aa; }
    .organ-cornea { background: #f0fdfa; color: #0f766e; border: 1px solid #99f6e4; }
    .organ-skin { background: #fef2f2; color: #991b1b; border: 1px solid #fecaca; }
    .organ-bone { background: #faf5ff; color: #7c3aed; border: 1px solid #e9d5ff; }
    
    /* Health Status Indicator */
    .health-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 8px;
    }
    
    .health-excellent { background-color: #10b981; }
    .health-good { background-color: #3b82f6; }
    .health-fair { background-color: #f59e0b; }
    .health-poor { background-color: #ef4444; }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 dark:bg-gray-900 py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <!-- üéØ Page Header Section -->
        <div class="mb-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900 dark:text-white flex items-center">
                        <span class="bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 p-3 rounded-xl mr-4">‚ù§Ô∏è</span>
                        Donor Dashboard
                    </h1>
                    <p class="mt-2 text-gray-600 dark:text-gray-400">
                        Manage your organ donation profile, track your impact, and help save lives.
                    </p>
                </div>
                
                <!-- Availability Toggle -->
                <div class="flex items-center space-x-4 mt-4 md:mt-0">
                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Availability Status</span>
                    <div class="relative inline-block w-12 mr-2 align-middle select-none">
                        <input type="checkbox" name="availability_toggle" id="availability_toggle"
                               class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"
                               {% if donor.is_available %}checked{% endif %}>
                        <label for="availability_toggle" 
                               class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                    </div>
                    <span id="availability_status" class="text-sm font-medium {% if donor.is_available %}text-green-600 dark:text-green-400{% else %}text-red-600 dark:text-red-400{% endif %}">
                        {% if donor.is_available %}Available{% else %}Unavailable{% endif %}
                    </span>
                </div>
            </div>
        </div>

        <!-- üìä Dashboard Statistics -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Organs Donating -->
            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Organs Donating</p>
                        <h3 class="text-2xl font-bold text-gray-900 dark:text-white mt-1">
                            {{ organs_count }}
                        </h3>
                        <p class="text-sm text-green-600 dark:text-green-400 mt-1">
                            Active for donation
                        </p>
                    </div>
                    <div class="text-3xl text-green-500">ü´Ä</div>
                </div>
            </div>

            <!-- Profile Completeness -->
            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Profile Complete</p>
                        <h3 class="text-2xl font-bold text-gray-900 dark:text-white mt-1">
                            {% if profile_complete %}100%{% else %}75%{% endif %}
                        </h3>
                        <p class="text-sm text-blue-600 dark:text-blue-400 mt-1">
                            Ready for matching
                        </p>
                    </div>
                    <div class="text-3xl text-blue-500">üìã</div>
                </div>
            </div>

            <!-- Health Status -->
            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Health Status</p>
                        <h3 class="text-2xl font-bold text-gray-900 dark:text-white mt-1 capitalize">
                            {{ donor.health_status }}
                        </h3>
                        <div class="flex items-center mt-1">
                            <span class="health-indicator health-{{ donor.health_status }}"></span>
                            <span class="text-sm text-gray-600 dark:text-gray-400">
                                {% if donor.health_status == 'excellent' %}Optimal for donation
                                {% elif donor.health_status == 'good' %}Good condition
                                {% elif donor.health_status == 'fair' %}Moderate condition
                                {% else %}Requires evaluation{% endif %}
                            </span>
                        </div>
                    </div>
                    <div class="text-3xl text-yellow-500">üí™</div>
                </div>
            </div>

            <!-- Last Updated -->
            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Last Updated</p>
                        <h3 class="text-2xl font-bold text-gray-900 dark:text-white mt-1">
                            {{ last_update|date:"M d" }}
                        </h3>
                        <p class="text-sm text-purple-600 dark:text-purple-400 mt-1">
                            Profile active
                        </p>
                    </div>
                    <div class="text-3xl text-purple-500">üîÑ</div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- üéØ Quick Actions -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Organs Donating Section -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
                    <div class="border-b border-gray-200 dark:border-gray-700 px-6 py-4">
                        <h2 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                            <span class="bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 p-2 rounded-lg mr-3">ü´Ä</span>
                            Organs Available for Donation
                        </h2>
                    </div>
                    
                    <div class="p-6">
                        {% if donor.organs_donating %}
                        <div class="flex flex-wrap gap-2 mb-4">
                            {% for organ in donor.organs_donating %}
                            <span class="organ-tag organ-{{ organ|lower }}">{{ organ }}</span>
                            {% endfor %}
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-400">
                            These organs are currently available for matching with recipients in need.
                        </p>
                        {% else %}
                        <div class="text-center py-4 text-gray-500 dark:text-gray-400">
                            <div class="text-4xl mb-2">üìù</div>
                            <p>No organs selected for donation</p>
                            <p class="text-sm mt-2">Update your profile to add organs you wish to donate</p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Health Information -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
                    <div class="border-b border-gray-200 dark:border-gray-700 px-6 py-4">
                        <h2 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                            <span class="bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 p-2 rounded-lg mr-3">üíä</span>
                            Health Information
                        </h2>
                    </div>
                    
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600 dark:text-gray-400">Smoking Status</span>
                                    <span class="text-sm font-medium text-gray-900 dark:text-white capitalize">
                                        {{ donor.smoking_status }}
                                    </span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600 dark:text-gray-400">Drug Use</span>
                                    <span class="text-sm font-medium text-gray-900 dark:text-white">
                                        {{ donor.drug_use|yesno:"Yes,No" }}
                                    </span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600 dark:text-gray-400">Alcohol Use</span>
                                    <span class="text-sm font-medium text-gray-900 dark:text-white capitalize">
                                        {{ donor.alcohol_use }}
                                    </span>
                                </div>
                            </div>
                            <div class="space-y-3">
                                {% if donor.height %}
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600 dark:text-gray-400">Height</span>
                                    <span class="text-sm font-medium text-gray-900 dark:text-white">
                                        {{ donor.height }} cm
                                    </span>
                                </div>
                                {% endif %}
                                {% if donor.weight %}
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600 dark:text-gray-400">Weight</span>
                                    <span class="text-sm font-medium text-gray-900 dark:text-white">
                                        {{ donor.weight }} kg
                                    </span>
                                </div>
                                {% endif %}
                                {% if donor.bmi %}
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600 dark:text-gray-400">BMI</span>
                                    <span class="text-sm font-medium text-gray-900 dark:text-white">
                                        {{ donor.bmi }}
                                    </span>
                                </div>
                                {% endif %}
                                {% if donor.last_medical_checkup %}
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600 dark:text-gray-400">Last Medical Check</span>
                                    <span class="text-sm font-medium text-gray-900 dark:text-white">
                                        {{ donor.last_medical_checkup|date:"M d, Y" }}
                                    </span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
                    <div class="border-b border-gray-200 dark:border-gray-700 px-6 py-4">
                        <h2 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                            <span class="bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 p-2 rounded-lg mr-3">‚ö°</span>
                            Quick Actions
                        </h2>
                    </div>
                    
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <a href="{% url 'profiles:edit_profile' %}" 
                               class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors">
                                <div class="flex items-center">
                                    <span class="text-2xl text-blue-600 dark:text-blue-400 mr-3">‚úèÔ∏è</span>
                                    <div>
                                        <div class="font-medium text-blue-900 dark:text-blue-100">Edit Profile</div>
                                        <div class="text-sm text-blue-700 dark:text-blue-300">Update your information</div>
                                    </div>
                                </div>
                            </a>
                            
                            <a href="{% url 'matches:find_matches' %}" 
                               class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4 hover:bg-green-100 dark:hover:bg-green-900/30 transition-colors">
                                <div class="flex items-center">
                                    <span class="text-2xl text-green-600 dark:text-green-400 mr-3">üîç</span>
                                    <div>
                                        <div class="font-medium text-green-900 dark:text-green-100">Find Matches</div>
                                        <div class="text-sm text-green-700 dark:text-green-300">See potential recipients</div>
                                    </div>
                                </div>
                            </a>
                            
                            <a href="{% url 'profiles:public_profile' user_id=request.user.id %}" 
                               class="bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg p-4 hover:bg-purple-100 dark:hover:bg-purple-900/30 transition-colors">
                                <div class="flex items-center">
                                    <span class="text-2xl text-purple-600 dark:text-purple-400 mr-3">üëÅÔ∏è</span>
                                    <div>
                                        <div class="font-medium text-purple-900 dark:text-purple-100">View Public Profile</div>
                                        <div class="text-sm text-purple-700 dark:text-purple-300">How others see you</div>
                                    </div>
                                </div>
                            </a>
                            
                            <a href="#" 
                               class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 hover:bg-yellow-100 dark:hover:bg-yellow-900/30 transition-colors">
                                <div class="flex items-center">
                                    <span class="text-2xl text-yellow-600 dark:text-yellow-400 mr-3">üìä</span>
                                    <div>
                                        <div class="font-medium text-yellow-900 dark:text-yellow-100">View Analytics</div>
                                        <div class="text-sm text-yellow-700 dark:text-yellow-300">Your impact stats</div>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- üìã Profile Summary & Resources -->
            <div class="space-y-6">
                <!-- Profile Summary -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                    <h3 class="font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                        <span class="bg-gray-100 dark:bg-gray-900/30 text-gray-600 dark:text-gray-400 p-2 rounded-lg mr-3">üë§</span>
                        Profile Summary
                    </h3>
                    
                    <div class="space-y-3 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600 dark:text-gray-400">Name</span>
                            <span class="font-medium text-gray-900 dark:text-white">{{ donor.user.get_full_name|default:donor.user.username }}</span>
                        </div>
                        {% if donor.user.city %}
                        <div class="flex justify-between">
                            <span class="text-gray-600 dark:text-gray-400">Location</span>
                            <span class="font-medium text-gray-900 dark:text-white">{{ donor.user.city }}</span>
                        </div>
                        {% endif %}
                        {% if donor.user.age %}
                        <div class="flex justify-between">
                            <span class="text-gray-600 dark:text-gray-400">Age</span>
                            <span class="font-medium text-gray-900 dark:text-white">{{ donor.user.age }}</span>
                        </div>
                        {% endif %}
                        <div class="flex justify-between">
                            <span class="text-gray-600 dark:text-gray-400">Member Since</span>
                            <span class="font-medium text-gray-900 dark:text-white">{{ donor.user.date_joined|date:"M Y" }}</span>
                        </div>
                    </div>
                </div>

                <!-- Impact Statistics -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                    <h3 class="font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                        <span class="bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 p-2 rounded-lg mr-3">üìà</span>
                        Your Impact
                    </h3>
                    
                    <div class="space-y-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-600 dark:text-green-400">0</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Lives Impacted</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-blue-600 dark:text-blue-400">{{ organs_count }}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Potential Donations</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-purple-600 dark:text-purple-400">100%</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Profile Strength</div>
                        </div>
                    </div>
                </div>

                <!-- Resources & Support -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                    <h3 class="font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                        <span class="bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 p-2 rounded-lg mr-3">‚ÑπÔ∏è</span>
                        Resources
                    </h3>
                    
                    <div class="space-y-3">
                        <a href="#" class="flex items-center p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                            <span class="text-blue-500 mr-3">üìö</span>
                            <span class="text-sm text-gray-700 dark:text-gray-300">Donation Guidelines</span>
                        </a>
                        <a href="#" class="flex items-center p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                            <span class="text-green-500 mr-3">üè•</span>
                            <span class="text-sm text-gray-700 dark:text-gray-300">Medical Resources</span>
                        </a>
                        <a href="#" class="flex items-center p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                            <span class="text-purple-500 mr-3">ü§ù</span>
                            <span class="text-sm text-gray-700 dark:text-gray-300">Support Community</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Availability Toggle Functionality
        const availabilityToggle = document.getElementById('availability_toggle');
        const availabilityStatus = document.getElementById('availability_status');
        
        if (availabilityToggle) {
            availabilityToggle.addEventListener('change', function() {
                const isAvailable = this.checked;
                
                // AJAX request to update availability
                fetch("{% url 'profiles:toggle_availability' %}", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    body: JSON.stringify({})
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        availabilityStatus.textContent = data.is_available ? 'Available' : 'Unavailable';
                        availabilityStatus.className = `text-sm font-medium ${data.is_available ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}`;
                        
                        // Show success message
                        showNotification('Availability updated successfully!', 'success');
                    } else {
                        showNotification('Failed to update availability', 'error');
                        // Revert toggle state
                        availabilityToggle.checked = !isAvailable;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification('Network error occurred', 'error');
                    availabilityToggle.checked = !isAvailable;
                });
            });
        }

        // Notification function
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 ${
                type === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    });
</script>
{% endblock %}